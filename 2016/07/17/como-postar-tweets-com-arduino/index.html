
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Como postar tweets com Arduino</title>
    <meta name="description" content="Como tweetar e enviar requisições HTTP para o Twitter API através do Arduino e o módulo Ethernet ENC28J60">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="../../../../favicon.ico">

    <link rel="stylesheet" type="text/css" href="../../../../assets/css/screen.css?v=202f780a67">
    <link rel="stylesheet" type="text/css" href="../../../../assets/fonts/merriweather.css">
    
    <link rel="canonical" href="http://danielammorais.com/2016/07/17/como-postar-tweets-com-arduino/">
    <meta name="referrer" content="origin">
    
    <meta property="og:site_name" content="Daniela Morais">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Como postar tweets com Arduino">
    <meta property="og:description" content="Como tweetar e enviar requisições HTTP para o Twitter API através do Arduino e o módulo Ethernet ENC28J60">
    <meta property="og:url" content="http://danielammorais.com/2016/07/17/como-postar-tweets-com-arduino/">
    <meta property="og:image" content="http://danielammorais.com/content/images/2016/07/arduinoUno.jpg">
    <meta property="article:published_time" content="2016-07-17T08:06:00.000Z">
    <meta property="article:modified_time" content="2016-07-17T08:10:55.233Z">
    <meta property="article:tag" content="IoT">
    <meta property="article:tag" content="arduino">
    <meta property="article:tag" content="api">
    <meta property="article:tag" content="python">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Como postar tweets com Arduino">
    <meta name="twitter:description" content="Como tweetar e enviar requisições HTTP para o Twitter API através do Arduino e o módulo Ethernet ENC28J60">
    <meta name="twitter:url" content="http://danielammorais.com/2016/07/17/como-postar-tweets-com-arduino/">
    <meta name="twitter:image:src" content="http://danielammorais.com/content/images/2016/07/arduinoUno.jpg">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Daniela Morais">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="IoT, arduino, api, python">
    <meta name="twitter:site" content="@danielammorais">
    <meta name="twitter:creator" content="@danielammorais">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Daniela Morais",
        "logo": "http://danielammorais.com/ghost/img/ghosticon.jpg"
    },
    "author": {
        "@type": "Person",
        "name": "Daniela Morais",
        "image": "http://danielammorais.com/content/images/2016/05/15854671410_846358242c_z.jpg",
        "url": "http://danielammorais.com/author/danielamorais/",
        "sameAs": [
            "https://www.linkedin.com/in/danielammorais",
            "https://twitter.com/danielammorais"
        ]
    },
    "headline": "Como postar tweets com Arduino",
    "url": "http://danielammorais.com/2016/07/17/como-postar-tweets-com-arduino/",
    "datePublished": "2016-07-17T08:06:00.000Z",
    "dateModified": "2016-07-17T08:10:55.233Z",
    "image": "http://danielammorais.com/content/images/2016/07/arduinoUno.jpg",
    "keywords": "IoT, arduino, api, python",
    "description": "Como tweetar e enviar requisições HTTP para o Twitter API através do Arduino e o módulo Ethernet ENC28J60"
}
    </script>

    <meta name="generator" content="Ghost 0.8">
    <link rel="alternate" type="application/rss+xml" title="Daniela Morais" href="http://danielammorais.com/rss/">
    <!-- Config Prism -->
    <link rel="stylesheet" type="text/css" href="../../../../assets/css/prism.css?v=202f780a67"> 
</head>
<body class="post-template tag-iot tag-arduino tag-api tag-python nav-closed">

    

    <div class="site-wrapper">

        


<header class="main-header post-head " style="background-image: url(../../../../content/images/2016/07/arduinoUno.jpg)">
    <nav class="main-nav overlay clearfix">
        

        <!---->
         <a class="back-button icon-arrow-left" href="http://danielammorais.com">Home</a>   
    </nav>
</header>
<main class="content" role="main">
    <article class="post tag-iot tag-arduino tag-api tag-python">

        <header class="post-header"> 
            <h1 class="post-title">Como postar tweets com Arduino</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2016-07-17">17 July 2016</time>  on <a href="../../../../tag/iot/">IoT</a>, <a href="../../../../tag/arduino/">arduino</a>, <a href="../../../../tag/api/">api</a>, <a href="../../../../tag/python/">python</a>
            </section>
        </header>

        <section class="post-content">
            <p>Há muito tempo comprei um módulo Ethernet ENC28J60 e apenas recentemente tive um tempo livre para testá-lo. Anteriormente, todas as comunicações com servidores eram feitas por serial e usava uma biblioteca ótima em Java e em Python é tão simples que dispensa comentários (<del>nenhuma novidade</del>). <br>
<strong>Curiosidade off topic</strong>: A biblioteca para Java que utilizei foi desenvolvida pelo pessoal do <a href="http://panamahitek.com/">Panama Hitek</a>, isso em 2014 e eu conversei brevemente com eles por e-mail na época. Eis que esse ano por coincidência descobri que são todos colaboradores do Fedora também e esse mundo é <strong>realmente pequeno</strong>. </p>

<h4 id="twitterapi">Twitter API</h4>

<p>Antes de tudo, registre <a href="https://apps.twitter.com/app/new">aqui</a> o seu app no Twitter para poder utilizar a API. Não se esqueça de gerar o Token para poder postar tweets na sua conta, vá em "Keys and Access Tokens" &gt; "Create my access token"</p>

<h4 id="uipethernet">UIPEthernet</h4>

<p>É provável que use as bibliotecas etherShield e ETHER_28J60, as quais são específicas para esse módulo e existem muitos tutoriais. Porém existe uma muito mais legal (seriously) chamada UIPEthernet, ela é compatível com a famosa Ethernet, ou seja, qualquer exemplo que usa a  Ethernet (File &gt; Examples &gt; Ethernet) pode ser executado apenas substituindo a importação:</p>

<pre><code class="language-c">#include &lt;SPI.h&gt;
#include &lt;Ethernet.h&gt; //Apenas substituir por UIPEthernet.h
</code></pre>

<p>
O download pode ser feito <a href="https://github.com/ntruchsess/arduino_uip/releases">aqui</a> ou apenas:  </p>

<pre><code class="language-bash">$ cd ~/Arduino/libraries/
$ git clone https://github.com/ntruchsess/arduino_uip UIPEthernet
</code></pre>

<h4 id="possveissolues">Possíveis soluções</h4>

<h5 id="hardway">Hard way</h5>

<p>Você pode simplesmente criar sua própria biblioteca em C e enviar as requisições HTTPs para a API do Twitter, para consolar existe a <a href="https://arduino-tweet.appspot.com/">"Tweet Library for Arduino"</a> a qual está apenas defasada e não funciona nas versões mais recentes como Arduino IDE 1.6.4 <br>
<img src="../../../../content/images/2016/07/chucknorrisapproves.gif" alt=""></p>

<h5 id="easyway">Easy way</h5>

<p>Convenhamos que manipular ponteiros e enviar requisições com C pode não ser tão agradável, optei por um pequeno script em Python. <br>
O processo basicamente é: o Arduino apenas manda o conteúdo para o script e este que lida com a Twitter API.  </p>

<p>Se você nunca usou Python, é necessário baixar o Flask e Twython:  </p>

<pre><code class="language-bash">$ sudo pip install flask
$ sudo pip install twython 
</code></pre>

<p>Crie um arquivo chamado <em>apiConfig</em>, é nele que você vai inserir todas as chaves de acesso que o Twitter gerou para você  </p>

<pre><code class="language-bash">APP_KEY = 'your_APIKey'  
APP_SECRET = 'your_APISecret'  
OAUTH_TOKEN = 'your_accessToken'  
OAUTH_TOKEN_SECRET = 'your_tokenSecret'  
</code></pre>

<p>Na mesma pasta, crie um script chamado <em>tweet.py</em>  </p>

<pre><code class="language-python">from twython import Twython  
from flask import Flask  
import apiConfig

app = Flask(__name__)

APP_KEY = apiConfig.APP_KEY  
APP_SECRET = apiConfig.APP_SECRET  
OAUTH_TOKEN = apiConfig.OAUTH_TOKEN  
OAUTH_TOKEN_SECRET = apiConfig.OAUTH_TOKEN_SECRET 

twitter = Twython(APP_KEY, APP_SECRET, OAUTH_TOKEN, OAUTH_TOKEN_SECRET)

@app.route("/")
def index():  
    return "Hello world"

@app.route("/sendTweet/&lt;message&gt;")
def sendTweet(message):  
    twitter.update_status(status=message); 
    return "Done." 

if __name__ == '__main__':  
    #Fix here
    app.run(host="your_ip", port=8080, debug=True)
</code></pre>

<p>Obviamente que o script pode ser mil vezes melhor, numa API <strong>sempre retorne</strong> o código HTTP correto e trate as exceções ao menos.  </p>

<p>Destaque para o sticker do FISL deste ano \o/ <br>
<img src="../../../../content/images/2016/07/arduino.png" alt=""></p>

<p>O código do Arduino é bem simples, é uma alteração do exemplo. Lembre-se de alterar o IP do Arduino caso esteja sendo utilizado e de inserir o IP do server.  </p>

<pre><code class="language-c">#include &lt;SPI.h&gt;
#include &lt;UIPEthernet.h&gt;

byte mac[] = {0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED};  
char server[] = "ip_server"; //fix here  
IPAddress ip(192, 168, 1, 177);  
EthernetClient client;

void setup() {  
  Serial.begin(9600);
  if (Ethernet.begin(mac) == 0) {
    Serial.println("Failed to configure Ethernet using DHCP");
    Ethernet.begin(mac, ip);
  }
}

void loop() {  
  if (client.connect(server, 8080)) {
    Serial.println("connected");
    // Make a HTTP request:
    client.println("GET /sendTweet/Hello%20world%20by%20Arduino HTTP/1.1");
    client.println("Host: ipServer_withPort"); //fix here
    client.println("Connection: close");
    client.println();
client.stop();  
  } else {
    Serial.println("connection failed");
  }

  delay(5000);
}
</code></pre>

<p>Vamos dar algumas permissões para o script, suba o Flask e faça upload do código no Arduino.  </p>

<pre><code class="language-bash">$ chmod a+x tweet.py
$ python tweet.py
</code></pre>

<p>E finalmente.. <br>
</p><center><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Hello world by Arduino</p>— Daniela Morais (@danielammorais) <a href="https://twitter.com/danielammorais/status/754567798819479553">July 17, 2016</a></blockquote> <br>
<script async src="http://platform.twitter.com/widgets.js" charset="utf-8"></script></center>

<h4 id="algumasobservaes">Algumas observações</h4>

<p>Por enquanto, eu não consegui fazer requisições para servidores locais e nem ao menos conectava (ip's 192.168.x.x e localhost). O servidor que hospedou esse script não suportava https e em alguns momentos um erro sobre isso é retornado. <br>
<img src="../../../../content/images/2016/07/wtf_martian.gif" alt="" title=""> </p>

<p>Além disso, o Twitter não permite que seja postado sempre o mesmo conteúdo (obviamente) então  um erro será retornado se não houver nenhum delay longo ou variação do conteúdo. <br>
Lembre-se de tomar cuidado com caracteres, use sempre o <a href="http://meyerweb.com/eric/tools/dencoder/">URL Encoder/Decoder</a>. Se nada der certo, use o bom e velho curl ou wget para testar.</p>

<h4 id="andothercoolthings">And other cool things..</h4>

<h6 id="webserverwitharduino">WebServer with Arduino</h6>

<p><a href="https://www.arduino.cc/en/Tutorial/WebServer">https://www.arduino.cc/en/Tutorial/WebServer</a>  </p>

<h6 id="acendendoumledviainternetcomarduinoeoethernetshield">Acendendo um LED via Internet com Arduino e o Ethernet Shield</h6>

<p><a href="https://br.renatocandido.org/2013/09/acendendo-um-led-via-internet-com-arduino-e-o-ethernet-shield/">https://br.renatocandido.org/2013/09/acendendo-um-led-via-internet-com-arduino-e-o-ethernet-shield/</a>  </p>

<h6 id="tweetduino">Tweetduino</h6>

<p><a href="https://github.com/danielamorais/tweetduino.git">https://github.com/danielamorais/tweetduino.git</a>  </p>

<h4 id="referncias">Referências</h4>

<h6 id="arduinoethernetpushingdatatoaphpserver">Arduino Ethernet – Pushing data to a (PHP) server</h6>

<p><a href="http://www.tweaking4all.com/hardware/arduino/arduino-ethernet-data-push/">http://www.tweaking4all.com/hardware/arduino/arduino-ethernet-data-push/</a>  </p>

<h6 id="howtosendtweetfromcommandlineusingpython">How to Send Tweet From Command Line using Python</h6>

<p><a href="http://www.techplugg.com/send-tweet-command-line-python/">http://www.techplugg.com/send-tweet-command-line-python/</a></p>
            
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="../../../../author/danielamorais/" style="background-image: url(../../../../content/images/2016/05/15854671410_846358242c_z.jpg)"><span class="hidden">Daniela Morais's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="../../../../author/danielamorais/">Daniela Morais</a></h4>

                    <p>Read <a href="../../../../author/danielamorais/">more posts</a> by this author.</p>
                <div class="author-meta">
                    <span class="author-location icon-location">Sao Paulo, Brazil</span>
                    <span class="author-link icon-link"><a href="https://www.linkedin.com/in/danielammorais">https://www.linkedin.com/in/danielammorais</a></span>
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Como%20postar%20tweets%20com%20Arduino&amp;url=http://danielammorais.com/2016/07/17/como-postar-tweets-com-arduino/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://danielammorais.com/2016/07/17/como-postar-tweets-com-arduino/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://danielammorais.com/2016/07/17/como-postar-tweets-com-arduino/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>
        <!--Config Disqus -->
<section class="post-content">
<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    
    var disqus_config = function () {
        this.page.url = 'http://danielammorais.com/2016/07/17/como-postar-tweets-com-arduino/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'ghost-3' // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//danielammoraiscom.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

     </section>
    </article>
    
    
</main>

<aside class="read-next">
    <a class="read-next-story " style="background-image: url(../../../../content/images/2016/07/1.png)" href="../../22/festival-une-arte-e-tecnologia/">
        <section class="post">
            <h2>Festival une arte e tecnologia</h2>
            <p>Festival Internacional de Linguagem Eletrônica Robinson, obra de Taiwan e Reino Unido, possui várias expressões faciais que mudam de…</p>
        </section>
    </a>
    <a class="read-next-story prev " style="background-image: url(../../../../content/images/2016/07/releaseParty.jpg)" href="../../04/fedora-24-release-party-in-sao-paulo/">
        <section class="post">
            <h2>Fedora 24 Release Party in Sao Paulo</h2>
            <p>Every time a new Fedora release is available, the community organizes events around the world to celebrate. Those events…</p>
        </section>
    </a>
</aside>



        <footer class="site-footer clearfix">
            <!--<section class="copyright"><a href="http://danielammorais.com">Daniela Morais</a> &copy; 2016</section>-->
            <!--<section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>-->
        </footer>

    </div>

    <script type="text/javascript" src="../../../../assets/js/jquery-1.12.0.min.js"></script>
    <script type="text/javascript" src="../../../../assets/js/jquery.fitvids.js?v=202f780a67"></script>
    <script type="text/javascript" src="../../../../assets/js/index.js?v=202f780a67"></script>
    <!-- Config Prism -->
    <script type="text/javascript" src="../../../../assets/js/prism.js?v=202f780a67"></script>
</body>
